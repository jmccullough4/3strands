{% extends 'layouts/base.html' %}
{% block content %}
  <div class="row g-4 mb-4">
    <div class="col-xl-8">
      <div class="card card-farm h-100">
        <div class="card-body d-flex flex-column flex-lg-row align-items-lg-center gap-4">
          <div class="flex-grow-1">
            <h1 class="h3 brand-emerald text-uppercase mb-2">Pasture-to-Table Command Center</h1>
            <p class="mb-3 text-secondary">Track the resources that power 3 Strands Cattle Co. — from pasture plans to packaging checklists — all in one place.</p>
            <div class="d-flex flex-wrap gap-3">
              <a class="btn btn-brand" href="#file-share">Jump to File Share</a>
              {% if session.get('is_admin') %}
                <a class="btn btn-outline-straw" href="{{ url_for('manage_users') }}">Manage Team</a>
              {% endif %}
            </div>
          </div>
          <div class="text-lg-end">
            <div class="small text-secondary">Next up:</div>
            <div class="h5 mb-1 brand-accent">Cooler Temperature Logs</div>
            <p class="mb-0 text-secondary">Stay tuned for live monitoring of every cooler from pasture to plate.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4">
      <div class="card cooler-placeholder h-100">
        <div class="card-body d-flex flex-column gap-3">
          <div class="d-flex justify-content-between align-items-start">
            <h2 class="h4 brand-accent mb-0">Cooler Logs</h2>
            <span class="temp-pill">Coming Soon</span>
          </div>
          <p class="text-secondary mb-0">We&rsquo;re getting the chillers wired up! Soon you&rsquo;ll track beef, pork, and chicken temperatures with automated alerts.</p>
          <ul class="small text-secondary mb-0 ps-3">
            <li>Real-time USDA-compliant temp checks</li>
            <li>Downloadable audit trails</li>
            <li>Alerts when thresholds are crossed</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 align-items-stretch" id="file-share">
    <div class="col-xl-8">
      <div class="card h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
            <div>
              <h2 class="card-title h4 mb-0 brand-accent">Team File Library</h2>
              <p class="text-secondary mb-0">Browse and download shared ranch resources.</p>
            </div>
          </div>
          <div class="table-responsive flex-grow-1">
            <table class="table table-dark table-hover align-middle mb-0 caption-top">
              <caption class="text-secondary">Share grazing schedules, butcher packets, and marketing assets with the crew.</caption>
              <thead>
                <tr class="text-uppercase small text-secondary">
                  <th scope="col">File name</th>
                  <th scope="col">Uploaded by</th>
                  <th scope="col">Uploaded on</th>
                  <th scope="col" class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% if files %}
                  {% for file in files %}
                    <tr>
                      <td class="fw-semibold">{{ file['original_name'] }}</td>
                      <td>{{ file['username'] }}</td>
                      <td>{{ file['uploaded_at'] | default('') }}</td>
                      <td class="text-end">
                        <a class="btn btn-sm btn-outline-warning me-2" href="{{ url_for('download_file', file_id=file['id']) }}">Download</a>
                        {% if session.get('is_admin') or session.get('username') == file['username'] %}
                          <form class="d-inline" action="{{ url_for('delete_file', file_id=file['id']) }}" method="post" onsubmit="return confirm('Delete this file?');">
                            <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                          </form>
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="4" class="text-center text-secondary py-4">No files have been shared yet. Upload the first document to get started.</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4">
      <div class="card h-100">
        <div class="card-body">
          <h2 class="card-title h4 mb-3 brand-accent">Share a File</h2>
          <p class="text-secondary">Upload grazing logs, butcher cut sheets, recipes, or any ranch-ready resource for the team.</p>
          <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" class="d-grid gap-3">
            <div>
              <label for="file" class="form-label">Choose file</label>
              <input class="form-control" type="file" id="file" name="file" required>
            </div>
            <button class="btn btn-brand" type="submit">Upload to Shared Drive</button>
          </form>
          <div class="mt-3 small text-secondary">
            <strong>Note:</strong> Maximum upload size is 20&nbsp;MB. Files can be removed by their uploader or an administrator.
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
